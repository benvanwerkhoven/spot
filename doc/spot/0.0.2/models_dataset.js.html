<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>models/dataset.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CategorialRule.html">CategorialRule</a><ul class='methods'><li data-type='method'><a href="CategorialRule.html#.match">match</a></li><li data-type='method'><a href="CategorialRule.html#.transform">transform</a></li></ul></li><li><a href="CategorialTransform.html">CategorialTransform</a></li><li><a href="Chart.html">Chart</a></li><li><a href="ContinuousTransform.html">ContinuousTransform</a><ul class='methods'><li data-type='method'><a href="ContinuousTransform.html#.transform">transform</a></li></ul></li><li><a href="Dataset.html">Dataset</a><ul class='methods'><li data-type='method'><a href="Dataset.html#.extendFacet">extendFacet</a></li><li data-type='method'><a href="Dataset.html#.extendFilters">extendFilters</a></li><li data-type='method'><a href="Dataset.html#.getAllData">getAllData</a></li><li data-type='method'><a href="Dataset.html#.pause">pause</a></li><li data-type='method'><a href="Dataset.html#.play">play</a></li><li data-type='method'><a href="Dataset.html#.scanData">scanData</a></li></ul></li><li><a href="Facet.html">Facet</a><ul class='methods'><li data-type='method'><a href="Facet.html#.sample10">sample10</a></li><li data-type='method'><a href="Facet.html#.setCategories">setCategories</a></li><li data-type='method'><a href="Facet.html#.setExceedances">setExceedances</a></li><li data-type='method'><a href="Facet.html#.setMinMax">setMinMax</a></li><li data-type='method'><a href="Facet.html#.setPercentiles">setPercentiles</a></li></ul></li><li><a href="Filter.html">Filter</a><ul class='methods'><li data-type='method'><a href="Filter.html#.getData">getData</a></li><li data-type='method'><a href="Filter.html#.initDataFilter">initDataFilter</a></li><li data-type='method'><a href="Filter.html#.initSelection">initSelection</a></li><li data-type='method'><a href="Filter.html#.releaseDataFilter">releaseDataFilter</a></li><li data-type='method'><a href="Filter.html#.updateDataFilter">updateDataFilter</a></li></ul></li><li><a href="Group.html">Group</a></li><li><a href="Selection.html">Selection</a><ul class='methods'><li data-type='method'><a href="Selection.html#.reset">reset</a></li><li data-type='method'><a href="Selection.html#.update">update</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-client_colors.html">client/colors</a><ul class='methods'><li data-type='method'><a href="module-client_colors.html#.getColor">getColor</a></li></ul></li><li><a href="module-client_misval.html">client/misval</a></li><li><a href="module-client_util-crossfilter.html">client/util-crossfilter</a><ul class='methods'><li data-type='method'><a href="module-client_util-crossfilter.html#~baseValueFn">baseValueFn</a></li><li data-type='method'><a href="module-client_util-crossfilter.html#~groupFn">groupFn</a></li><li data-type='method'><a href="module-client_util-crossfilter.html#~reduceFn">reduceFn</a></li><li data-type='method'><a href="module-client_util-crossfilter.html#~unpackArray">unpackArray</a></li><li data-type='method'><a href="module-client_util-crossfilter.html#~valueFn">valueFn</a></li></ul></li><li><a href="module-client_util-sql.html">client/util-sql</a><ul class='methods'><li data-type='method'><a href="module-client_util-sql.html#~connect">connect</a></li></ul></li><li><a href="module-client_view-factory.html">client/view-factory</a><ul class='methods'><li data-type='method'><a href="module-client_view-factory.html#.newView">newView</a></li></ul></li><li><a href="module-client_widget-factory.html">client/widget-factory</a><ul class='methods'><li data-type='method'><a href="module-client_widget-factory.html#.newModel">newModel</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="Filter.html#event:newdata">newdata</a></li><li><a href="Filter.html#event:newfacets">newfacets</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">models/dataset.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * A Dataset is responsible for actually managing the data: based on the filters and their factes,
 * implement callbacks that return the processed data in a standardized format.
 *
 * To help analyze data, a few methods to help autoconfigure your session must be implemented.
 *
 * Implementations for Crossfilter (fully in memory client side filtering) and PostgreSQL datasets are available.
 * @class Dataset
 */

var AmpersandModel = require('ampersand-model');
var Filters = require('./filter-collection');
var Facets = require('./facet-collection');

function extendFacet (dataset, facet) {
  facet.setMinMax = function (transformed) {
    dataset.setMinMax(dataset, facet, transformed);
  };

  facet.sample10 = function () {
    return dataset.sample10(dataset, facet);
  };

  facet.setCategories = function (transformed) {
    dataset.setCategories(dataset, facet, transformed);
  };

  facet.setPercentiles = function () {
    dataset.setPercentiles(dataset, facet);
  };

  facet.setExceedances = function () {
    dataset.setExceedances(dataset, facet);
  };
}

function extendFilter (dataset, filter) {
  filter.initDataFilter = function () {
    dataset.releaseDataFilter(dataset, filter);
    dataset.initDataFilter(dataset, filter);
    dataset.updateDataFilter(dataset, filter);
    filter.initSelection();
    filter.trigger('newfacets');
    dataset.getAllData(dataset);
  };
  filter.releaseDataFilter = function () {
    dataset.releaseDataFilter(dataset, filter);
    filter.initSelection();
    filter.trigger('newfacets');
    dataset.getAllData(dataset);
  };
  filter.updateDataFilter = function () {
    dataset.updateDataFilter(dataset, filter);
    dataset.getAllData(dataset);
  };
}

function extendFacets (dataset, facets) {
  facets.forEach(function (f) {
    extendFacet(dataset, f);
  });
  facets.on('add', function (facet, facets, options) {
    extendFacet(dataset, facet);
  });
}

function extendFilters (dataset, filters) {
  filters.forEach(function (f) {
    extendFilter(dataset, f);
  });
  filters.on('add', function (filter, filters, options) {
    extendFilter(dataset, filter);
  });
}

function setPercentiles (dataset, facet) {
  console.error('Virtual method setPercentiles');
}

function setExceedances (dataset, facet) {
  console.error('Virtual method setExceedances');
}

function sample10 (dataset, facet) {
  console.error('Virtual method sample10');
}

function setMinMax (dataset, facet) {
  console.error('Virtual method setMinMax');
}

function setCategories (dataset, facet, transformed) {
  console.error('Virtual method setCategories');
}

function scanData () {
  console.error('Virtual method scanData');
}

function initDataFilter (filter) {
  console.error('Virtual method initDataFilter');
}

function releaseDataFilter (filter) {
  console.error('Virtual method releaseDataFilter');
}

function updateDataFilter (filter) {
  console.error('Virtual method updateDataFilter');
}

function getAllData (dataset) {
  if (dataset.isPaused) {
    return;
  }
  dataset.filters.forEach(function (filter, i) {
    if (filter.getData) {
      filter.getData();
    }
  });
}

module.exports = AmpersandModel.extend({
  props: {
    datasetType: {
      type: 'string',
      setOnce: true,
      default: 'generic'
    }
  },
  session: {
    /**
     * isPaused when true, calls to getAllData are ignored.
     * This is useful to suppres calls to getData
     * when adding and removing a number of filters at once.
     * @memberof! Dataset
     * @type {boolean}
     */
    isPaused: ['boolean', false, true]
  },
  collections: {
    /**
     * A Filter collection holding all active filters on the dataset
     * @memberof! Dataset
     * @type {Filter[]}
     */
    filters: Filters,
    /**
     * A Facet collection holding pre defined facets
     * @memberof! Dataset
     * @type {Facet[]}
     */
    facets: Facets
  },

  /**
   * Pause the dataset
   * @memberof Dataset
   */
  pause: function () {
    this.isPaused = true;
  },
  /**
   * Unpause the dataset
   * @memberof Dataset
   */
  play: function () {
    this.isPaused = false;
  },

  /**
   * getAllData
   * Refresh data for all filters, by calling getData for each filter in the filter collection.
   * @see pause and play
   * @memberof! Dataset
   * @function
   */
  getAllData: getAllData,

  /**
   * Autoconfigure a dataset:
   * 1. inspect the dataset, and create facets for the properties
   * 2. for continuous facets, guess the missing values, and set the minimum and maximum values
   * 3. for categorial facets, set the categorialTransform
   *
   * @memberof! Dataset
   * @function
   */
  scanData: scanData,

  /**
   * sample10 returns an array containing 10 distinct values this facet can take
   * @memberof! Facet
   * @virtual
   * @function
   */
  sample10: sample10,

  /**
   * setMinMax finds the range of a continuous facet,
   * @memberof! Facet
   * @virtual
   * @function
   */
  setMinMax: setMinMax,

  /**
   * setCategories finds finds all values on an ordinal (categorial) axis, before (transformed=false) or after (transfomr=true) transformation
   * Updates the categorialTransform property of the facet
   *
   * @memberof! Facet
   * @virtual
   * @function
   * @param {boolean} transformed
   */
  setCategories: setCategories,

  /**
   * Calculate 100 percentiles (ie. 1,2,3,4 etc.)
   * Use the recommended method from [NIST](http://www.itl.nist.gov/div898/handbook/prc/section2/prc262.htm)
   * See also the discussion on [Wikipedia](https://en.wikipedia.org/wiki/Percentile)
   *
   * @memberof! Facet
   * @virtual
   * @function
   */
  setPercentiles: setPercentiles,

  /**
   * Calculate value where exceedance probability is one in 10,20,30,40,50,
   * and the same for -exceedance -50, -60, -70, -80, -90, -99, -99.9, -99.99, ... percent
   * Approximate from data: 1 in 10 is larger than value at index trunc(0.1 * len(data))
   *
   * @memberof! Facet
   * @virtual
   * @function
   */
  setExceedances: setExceedances,

  /**
   * initDataFilter
   * Initialize the data filter, and construct the getData callback function on the filter.
   * @memberof! Filter
   * @function
   * @virtual
   */
  initDataFilter: initDataFilter,

  /**
   * relaseDataFilter
   * The opposite or initDataFilter, it should remove the filter and deallocate
   * other data related to the filter.
   * @memberof! Filter
   * @function
   * @virtual
   */
  releaseDataFilter: releaseDataFilter,

  /**
   * updateDataFilter
   * Change the filter parameters for an initialized filter
   * @memberof! Filter
   * @function
   * @virtual
   */
  updateDataFilter: updateDataFilter,

  /**
   * Extends a Facet by adding the dataset dependent callback functions:
   * setMinMax, setCategories, setExceedances, setPercentiles
   * Automatically called when adding facets to the dataset
   * @memberof! Dataset
   * @function
   * @param {Dataset} dataset
   * @param {Facet} facet
   */
  extendFacet: extendFacet,
  extendFacets: extendFacets,

  /**
   * Extends a Filter by adding the dataset dependent callback functions:
   * initDataFilter, updateDataFilter, releaseDataFilter
   * Automatically called when adding filters to the dataset
   * @memberof! Dataset
   * @function
   * @param {Dataset} dataset
   * @param {Filter} filter
   */
  extendFilters: extendFilters
});
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Tue Jul 26 2016 16:22:41 GMT+0200 (CEST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
